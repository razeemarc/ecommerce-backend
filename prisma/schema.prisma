

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql" 
  url      = env("DATABASE_URL")
}

//enums
enum Gender {
  male
  female
  others
}
enum Role {
  ADMIN
  USER
}
enum AddressType {
  Home
  Work
}

enum OrderStatus {
  PENDING
  PAID
  SHIPPED
  DELIVERED
  CANCELLED
}

enum PaymentStatus {
  PENDING
  SUCCESS
  FAILED
  REFUNDED
}

enum PaymentMethod {
  CARD
  UPI
  COD
  WALLET
}

// MODELS


model Auth {
  id          String   @id @default(uuid())
  email       String   @unique
  password    String
  is_active   Boolean @default(true)
  last_login  DateTime?
  is_deleted  Boolean  @default(false)
  deleted_at  DateTime?
  created_at  DateTime @default(now())
  updated_at  DateTime @updatedAt
  user        User?
}


model User {
  id           String    @id @default(uuid())
  code         String    @unique
  name         String
  role         Role      @default(USER)
  phone        String    @unique
  gender       Gender?
  is_deleted   Boolean   @default(false)
  deleted_at   DateTime?
  created_at   DateTime  @default(now())
  updated_at   DateTime  @updatedAt

  authId       String? @unique
  auth         Auth?     @relation(fields: [authId], references: [id], onDelete: Cascade)

  addresses    Addressbook[]
  reviews      Review[]
  orders       Order[]
  wishlist     Wishlist[]
  cart         Cart[]
}


model Addressbook {
  id           String   @id @default(uuid())
  userId       String
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  name         String
  phoneNo      String
  pincode      String
  address      String
  city         String
  state        String
  landmark     String?
  addressType  AddressType
  is_default   Boolean  @default(false)
  is_deleted   Boolean  @default(false)
  deleted_at   DateTime?
  created_at   DateTime @default(now())
  updated_at   DateTime @updatedAt

  orders       Order[]
}


model Category {
  id          String   @id @default(uuid())
  name        String   @unique
  imageKey    String?
  is_deleted  Boolean  @default(false)
  deleted_at  DateTime?
  created_at  DateTime @default(now())
  updated_at  DateTime @updatedAt

  brands      Brand[]
  products    Product[]
}


model Brand {
  id           String   @id @default(uuid())
  name         String
  imageKey     String?
  categoryId   String?
  category     Category? @relation(fields: [categoryId], references: [id], onDelete: SetNull)
  is_deleted   Boolean   @default(false)
  deleted_at   DateTime?
  created_at   DateTime  @default(now())
  updated_at   DateTime  @updatedAt

  products     Product[]
}


model Product {
  id             String   @id @default(uuid())
  name           String   @unique
  categoryId     String?
  category       Category? @relation(fields: [categoryId], references: [id], onDelete: SetNull)
  brandId        String?
  brand          Brand?    @relation(fields: [brandId], references: [id], onDelete: SetNull)
  stock          Int       @default(0)
  min_quantity   Int       @default(0)
  price          Decimal   @db.Decimal(12, 2)
  mrp            Decimal   @db.Decimal(12, 2)
  ratings        Float?
  description    String?
  specification  String?
  is_deleted     Boolean   @default(false)
  deleted_at     DateTime?
  created_at     DateTime  @default(now())
  updated_at     DateTime  @updatedAt

  images         ProductImage[]
  reviews        Review[]
  orderItems     OrderItem[]
  wishlist       Wishlist[]
  cart           Cart[]
  bannerItems    BannerItem[]
}


model ProductImage {
  id           String   @id @default(uuid())
  productId    String
  product      Product  @relation(fields: [productId], references: [id], onDelete: Cascade)
  imageKey     String
  order        Int?
  is_deleted   Boolean   @default(false)
  deleted_at   DateTime?
  created_at   DateTime  @default(now())
  updated_at   DateTime  @updatedAt
}


model Review {
  id           String   @id @default(uuid())
  userId       String
  productId    String
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  product      Product  @relation(fields: [productId], references: [id], onDelete: Cascade)
  rating       Float
  title        String?
  comment      String?
  is_deleted   Boolean   @default(false)
  deleted_at   DateTime?
  created_at   DateTime  @default(now())
  updated_at   DateTime  @updatedAt

  images       ReviewImage[]
}


model ReviewImage {
  id           String   @id @default(uuid())
  review_id    String
  review       Review   @relation(fields: [review_id], references: [id], onDelete: Cascade)
  imageKey     String
  order        Int?
  is_deleted   Boolean   @default(false)
  deleted_at   DateTime?
  created_at   DateTime  @default(now())
  updated_at   DateTime  @updatedAt
}


model Wishlist {
  id           String   @id @default(uuid())
  userId       String
  productId    String
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  product      Product  @relation(fields: [productId], references: [id], onDelete: Cascade)
  is_deleted   Boolean   @default(false)
  deleted_at   DateTime?
  created_at   DateTime  @default(now())
  updated_at   DateTime  @updatedAt

  @@unique([userId, productId])
}


model Cart {
  id           String   @id @default(uuid())
  userId       String
  productId    String
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  product      Product  @relation(fields: [productId], references: [id], onDelete: Cascade)
  quantity     Int       @default(1)
  is_deleted   Boolean   @default(false)
  deleted_at   DateTime?
  created_at   DateTime  @default(now())
  updated_at   DateTime  @updatedAt

  @@unique([userId, productId])
}


model Banner {
  id           String   @id @default(uuid())
  name         String
  is_deleted   Boolean   @default(false)
  deleted_at   DateTime?
  created_at   DateTime  @default(now())
  updated_at   DateTime  @updatedAt

  items        BannerItem[]
}


model BannerItem {
  id           String   @id @default(uuid())
  bannerId     String
  productId    String
  banner       Banner   @relation(fields: [bannerId], references: [id], onDelete: Cascade)
  product      Product  @relation(fields: [productId], references: [id], onDelete: Cascade)
  is_deleted   Boolean   @default(false)
  deleted_at   DateTime?
  created_at   DateTime  @default(now())
  updated_at   DateTime  @updatedAt
}


model Order {
  id             String   @id @default(uuid())
  userId         String
  addressbookId  String
  code           String   @unique
  status         OrderStatus @default(PENDING)
  total_amount   Decimal   @db.Decimal(12, 2)
  is_deleted     Boolean   @default(false)
  deleted_at     DateTime?
  created_at     DateTime  @default(now())
  updated_at     DateTime  @updatedAt

  user           User       @relation(fields: [userId], references: [id], onDelete: Cascade)
  addressbook    Addressbook @relation(fields: [addressbookId], references: [id], onDelete: Cascade)
  items          OrderItem[]
  payments       Payment[]
}


model OrderItem {
  id           String   @id @default(uuid())
  orderId      String
  productId    String
  quantity     Int
  total_price  Decimal   @db.Decimal(12, 2)
  order        Order     @relation(fields: [orderId], references: [id], onDelete: Cascade)
  product      Product   @relation(fields: [productId], references: [id], onDelete: Cascade)
  is_deleted   Boolean   @default(false)
  deleted_at   DateTime?
  created_at   DateTime  @default(now())
  updated_at   DateTime  @updatedAt
}


model Payment {
  id                  String   @id @default(uuid())
  orderId             String
  order               Order    @relation(fields: [orderId], references: [id], onDelete: Cascade)
  amount              Decimal  @db.Decimal(12, 2)
  status              PaymentStatus @default(PENDING)
  payment_method      PaymentMethod
  provider_payment_id String?
  reference_no        String?
  is_deleted          Boolean   @default(false)
  deleted_at          DateTime?
  created_at          DateTime  @default(now())
  updated_at          DateTime  @updatedAt
}
